var JobQ=function(t){function s(n){if(e[n])return e[n].exports;var r=e[n]={exports:{},id:n,loaded:!1};return t[n].call(r.exports,r,r.exports,s),r.loaded=!0,r.exports}var e={};return s.m=t,s.c=e,s.p="",s(0)}([function(t,s){"use strict";function e(t,s){if(!(t instanceof s))throw new TypeError("Cannot call a class as a function")}var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r=function(){function t(t,s){for(var e=0;e<s.length;e++){var n=s[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(s,e,n){return e&&t(s.prototype,e),n&&t(s,n),s}}(),i="Configuration Object Required",o="required paramenter [process] must be a function",u="Source is required to be a function, promise or array",a="parameter stopOnError must be a boolean",c="Only Function source can be used with pooling",h=function(){function t(s){if(e(this,t),!s)throw new Error(i);if(!s.process||"function"!=typeof s.process)throw new Error(o);if(!s.source||"function"!=typeof s.source&&!Array.isArray(s.source)&&!s.source.then)throw new Error(u);if(s.stopOnError&&"boolean"!=typeof s.stopOnError)throw new Error(a);if(this.events={},this.debug=s.debug,this.maxProceses=s.maxProceses>=0?s.maxProceses:1,this.process=s.process,this.stopOnError=s.stopOnError||!1,this.sourceType=Array.isArray(s.source)?"array":s.source.then?"promise":"function","array"===this.sourceType?this.source=s.source.slice(0):this.source=s.source,this.running=0,this.jobsFinished=0,this.jobErrors=0,this.fillingJobs=!1,this.autoincrementId=0,this.status="stoped",this.paused=!1,this.poolingInterval=s.pooling>=0&&s.pooling,"array"===this.sourceType&&this.poolingInterval!==!1)throw new Error(c)}return r(t,[{key:"data",value:function(t){var s={startTime:this.startTime,processed:this.jobsFinished,errors:this.jobErrors,maxProceses:this.maxProceses,stopOnError:this.stopOnError,sourceType:this.sourceType,status:this.status};if(t)for(var e in t)t.hasOwnProperty(e)&&(s[e]=t[e]);return s}},{key:"start",value:function(){this.status="running",this.startTime=new Date,this.emit("start",this.data()),this.init()}},{key:"pause",value:function(){"running"!==this.status&&"pooling"!==this.status||(this.paused=!0,this.status="paused",this.emit("pause",this.data()))}},{key:"resume",value:function(){"running"!==this.status&&(this.paused=!1,this.status="running",this.emit("resume",this.data()),this.fillJobs())}},{key:"init",value:function(){var t=this;"promise"===this.sourceType?this.source.then(function(s){if(t.sourceType=Array.isArray(s)?"array":s.then?"promise":"function","array"===t.sourceType){if(t.poolingInterval!==!1)throw new Error(c);t.source=s.slice(0)}else t.source=s;t.init()}).catch(function(s){t.processFinish(s)}):this.fillJobs()}},{key:"processFinish",value:function(t){var s=this;t?(this.emit("error",t),this.status="error"):this.status="finished",this.poolingInterval===!1?this.emit("processFinish",this.data({endTime:new Date})):(this.status="pooling",this.empty=!1,this.emit("pooling",this.data()),setTimeout(function(){s.status="running",s.fillJobs()},this.poolingInterval))}},{key:"on",value:function(t,s){return this.events[t]=s,this}},{key:"emit",value:function(t,s){"error"===t&&this.stopOnError&&(this.status="error"),this.debug&&console&&console.log("["+new Date+"]["+t+"]",s),this.events[t]&&this.events[t](s)}},{key:"runningJobsCount",value:function(){return this.running}},{key:"runJob",value:function(t){var s=this;this.running++;var e=++this.autoincrementId;this.emit("jobRun",e);var n=function(){var t=--s.running;return!t&&"empty"===s.status||"error"===s.status?(s.status="finished",s.processFinish()):void s.fillJobs()},r=new Date;t(function(t,i){if(t)s.emit("error",t),s.jobErrors++;else if(i){var o=new Date;s.emit("jobFinish",{jobId:e,jobStartTime:r,jobEndTime:o,result:i,jobsRunning:s.running}),s.jobsFinished++}n()})}},{key:"fillJobs",value:function(){var t=this;if(!this.fillingJobs){this.fillingJobs=!0;for(var s=function(s,e){try{var r=function(){var n=!1;if(null!==s){var r=t.process(s,function(t,s){n||e(t,s)});if(r){if(n=!0,"function"==typeof r.then)return{v:r.then(function(t){e(null,t)}).catch(e)};e(null,r)}}else t.status="empty",e()}();if("object"===("undefined"==typeof r?"undefined":n(r)))return r.v}catch(t){e(t)}};!this.paused&&(0===this.maxProceses||this.running<this.maxProceses)&&"running"===this.status&&("array"===this.sourceType&&this.source.length||"array"!==this.sourceType);){this.emit("jobFetch",{jobsRunning:this.running});var e=function(e){var n=void 0,r=!1;"array"===t.sourceType?(n=t.source.splice(0,1)[0],t.source.length||(t.status="empty")):n=t.source(function(t,n){if(!r){if(t)return e(t);s(n,e)}}),void 0!==n&&(n&&n.then&&"function"==typeof n.then?n.then(function(t){s(t,e)}).catch(e):null!==n?(r=!0,s(n,e)):(t.status="empty",r=!0,e()))};this.runJob(e)}this.fillingJobs=!1}}}]),t}(),f=function(){function t(s){e(this,t),this.instance=new h(s)}return r(t,[{key:"on",value:function(t,s){return this.instance.on(t,s),this}},{key:"start",value:function(){return this.instance.start(),this}},{key:"pause",value:function(){return this.instance.pause(),this}},{key:"resume",value:function(){return this.instance.resume(),this}},{key:"runningJobsCount",value:function(){return this.instance.runningJobsCount()}}]),t}();t.exports=f}]);