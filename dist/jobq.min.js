var JobQ=function(t){function e(n){if(s[n])return s[n].exports;var r=s[n]={exports:{},id:n,loaded:!1};return t[n].call(r.exports,r,r.exports,e),r.loaded=!0,r.exports}var s={};return e.m=t,e.c=s,e.p="",e(0)}([function(t,e){"use strict";function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r=function(){function t(t,e){for(var s=0;s<e.length;s++){var n=e[s];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,s,n){return s&&t(e.prototype,s),n&&t(e,n),e}}(),i="Configuration Object Required",o="required paramenter [process] must be a function",u="Source is required to be a function, promise or array",a="parameter stopOnError must be a boolean",c=function(){function t(e){if(s(this,t),!e)throw new Error(i);if(!e.process||"function"!=typeof e.process)throw new Error(o);if(!e.source||"function"!=typeof e.source&&!Array.isArray(e.source)&&!e.source.then)throw new Error(u);if(e.stopOnError&&"boolean"!=typeof e.stopOnError)throw new Error(a);this.events={},this.debug=e.debug,this.maxProceses=e.maxProceses>=0?e.maxProceses:1,this.process=e.process,this.stopOnError=e.stopOnError||!1,this.sourceType=Array.isArray(e.source)?"array":e.source.then?"promise":"function","array"===this.sourceType?this.source=e.source.slice(0):this.source=e.source,this.running=0,this.jobsFinished=0,this.jobErrors=0,this.fillingJobs=!1,this.autoincrementId=0,this.status="stoped",this.paused=!1}return r(t,[{key:"data",value:function(t){return Object.assign({startTime:this.startTime,processed:this.jobsFinished,errors:this.jobErrors,maxProceses:this.maxProceses,stopOnError:this.stopOnError,sourceType:this.sourceType,status:this.status},t||{})}},{key:"start",value:function(){this.status="running",this.startTime=new Date,this.emit("start",this.data()),this.init()}},{key:"pause",value:function(){"running"===this.status&&(this.paused=!0,this.status="paused",this.emit("pause",this.data()))}},{key:"resume",value:function(){"running"!==this.status&&(this.paused=!1,this.status="running",this.emit("resume",this.data()),this.fillJobs())}},{key:"init",value:function(){var t=this;"promise"===this.sourceType?this.source.then(function(e){t.sourceType=Array.isArray(e)?"array":e.then?"promise":"function","array"===t.sourceType?t.source=e.slice(0):t.source=e,t.init()}).catch(function(e){t.processFinish(e)}):this.fillJobs()}},{key:"processFinish",value:function(t){t?(this.emit("error",t),this.status="error"):this.status="finished",this.emit("processFinish",this.data({endTime:new Date}))}},{key:"on",value:function(t,e){return this.events[t]=e,this}},{key:"emit",value:function(t,e){"error"===t&&this.stopOnError&&(this.status="error"),this.debug&&console&&console.log("["+new Date+"]["+t+"]",e),this.events[t]&&this.events[t](e)}},{key:"runningJobsCount",value:function(){return this.running}},{key:"runJob",value:function(t){var e=this;this.running++;var s=++this.autoincrementId;this.emit("jobRun",s);var n=function(){var t=--e.running;return!t&&"empty"===e.status||"error"===e.status?(e.status="finished",e.processFinish()):void e.fillJobs()},r=new Date;t(function(t,i){if(t)e.emit("error",t),e.jobErrors++;else if(i){var o=new Date;e.emit("jobFinish",{jobId:s,jobStartTime:r,jobEndTime:o,result:i,jobsRunning:e.running}),e.jobsFinished++}n()})}},{key:"fillJobs",value:function(){var t=this;if(!this.fillingJobs){this.fillingJobs=!0;for(var e=function(e,s){try{var r=function(){var n=!1;if(null!==e){var r=t.process(e,function(t,e){n||s(t,e)});if(r){if(n=!0,"function"==typeof r.then)return{v:r.then(function(t){s(null,t)}).catch(s)};s(null,r)}}else t.status="empty",s()}();if("object"===("undefined"==typeof r?"undefined":n(r)))return r.v}catch(t){s(t)}};!this.paused&&(0===this.maxProceses||this.running<this.maxProceses)&&"running"===this.status&&("array"===this.sourceType&&this.source.length||"array"!==this.sourceType);){this.emit("jobFetch",{jobsRunning:this.running});var s=function(s){var n=void 0,r=!1;"array"===t.sourceType?(n=t.source.splice(0,1)[0],t.source.length||(t.status="empty")):n=t.source(function(t,n){if(!r){if(t)return s(t);e(n,s)}}),void 0!==n&&(n&&n.then&&"function"==typeof n.then?n.then(function(t){e(t,s)}).catch(s):null!==n?(r=!0,e(n,s)):(t.status="empty",s()))};this.runJob(s)}this.fillingJobs=!1}}}]),t}(),h=function(){function t(e){s(this,t),this.instance=new c(e)}return r(t,[{key:"on",value:function(t,e){return this.instance.on(t,e),this}},{key:"start",value:function(){return this.instance.start(),this}},{key:"pause",value:function(){return this.instance.pause(),this}},{key:"resume",value:function(){return this.instance.resume(),this}},{key:"runningJobsCount",value:function(){return this.instance.runningJobsCount()}}]),t}();t.exports=h}]);